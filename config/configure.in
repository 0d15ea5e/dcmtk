dnl Process this file with autoconf to produce a configure script.
AC_INIT(Makefile.in)

dnl Configuration Utilities

dnl Get configuration directory
if test -d config ; then
	configdir=config
elif test -d ../config ; then
	configdir=../config
else
	echo "Cannot find configure directory (config or ../config)"
	exit 1
fi


AC_CONFIG_HEADER($configdir/include/config.h)
AC_CONFIG_AUX_DIR($configdir)
AC_PREFIX_DEFAULT(/usr/local/dicom)

dnl Checks for programs.
AC_PROG_MAKE_SET
AC_PROG_CC
AC_PROG_CPP
AC_CHECK_PROGS(CXX, $CCC c++ cc++ g++ gcc CC cxx, gcc)


if test "${CXXFLAGS}set" = set ; then
	case "$CXX" in
		c++|g++|gcc) CXXFLAGS='-g -Wall -pedantic' ;;
		cc++) CXXFLAGS='-g -Wall' ;;
		CC) CXXFLAGS='+w -g' ;;
	esac
fi
AC_SUBST(CXXFLAGS)

AC_PROG_CXXCPP
AC_PROG_RANLIB
AC_PROG_INSTALL
AC_CHECK_PROGS(AR, libtool ar)

case "$AR" in
libtool) ARFLAGS=-o ;;
ar) ARFLAGS=cruv ;;
esac

AC_SUBST(ARFLAGS)

dnl Check special systems
AC_AIX
AC_ISC_POSIX
AC_SYS_LONG_FILE_NAMES

dnl Check X11 paths
AC_PATH_XTRA

dnl Checks for libraries.
AC_LANG_CPLUSPLUS
AC_CHECK_GXXLIB
AC_CHECK_LIB(iostream, main)
AC_CHECK_LIB(nsl, main)
AC_CHECK_LIB(socket, main)

dnl Checks for header files.
AC_HEADER_STDC
AC_HEADER_SYS_WAIT
AC_CHECK_HEADERS(unistd.h)
AC_CHECK_HEADERS(libc.h)
AC_CHECK_HEADERS(unix.h)
AC_CHECK_HEADERS(stdlib.h)
AC_CHECK_HEADERS(sys/types.h)
AC_CHECK_HEADERS(sys/stat.h)
AC_CHECK_HEADERS(stat.h)
AC_CHECK_HEADERS(fcntl.h)
AC_CHECK_HEADERS(stdarg.h)
AC_CHECK_HEADERS(sys/file.h)
AC_CHECK_HEADERS(sys/socket.h)
AC_CHECK_HEADERS(sys/time.h)
AC_CHECK_HEADERS(netinet/in.h)
AC_CHECK_HEADERS(netdb.h)
AC_CHECK_HEADERS(stddef.h)
AC_CHECK_HEADERS(sys/utsname.h)
AC_CHECK_HEADERS(limits.h)

dnl Checks for typedefs, structures, and compiler characteristics.
AC_C_INLINE
AC_TYPE_SIZE_T
AC_CHECK_SIZEOF(char)
AC_CHECK_SIZEOF(short)
AC_CHECK_SIZEOF(int)
AC_CHECK_SIZEOF(long)
AC_CHECK_SIZEOF(float)
AC_CHECK_SIZEOF(double)
AC_TYPE_PID_T
AC_STRUCT_TM

dnl Checks for library functions.
AC_FUNC_MEMCMP
AC_FUNC_VPRINTF
AC_TYPE_SIGNAL
AC_FUNC_WAIT3
AC_CHECK_FUNCS(gethostname gethostid socket sysinfo)
AC_CHECK_FUNCS(strchr strstr strtoul itoa)
AC_CHECK_FUNCS(memcpy)
AC_CHECK_FUNCS(getpid mktemp getenv)
AC_CHECK_FUNCS(stat)
AC_CHECK_FUNCS(malloc_debug)
AC_CHECK_FUNCS(strerror strdup tempnam bzero index rindex access)
AC_CHECK_FUNCS(uname cuserid getlogin)
AC_CHECK_FUNCS(usleep)

dnl Checks for prototypes

AC_CHECK_PROTOTYPE(bzero)
AC_CHECK_PROTOTYPE(accept, sys/types.h sys/socket.h)
AC_CHECK_PROTOTYPE(bind, sys/types.h sys/socket.h)
AC_CHECK_PROTOTYPE(gethostbyname, netdb.h)
AC_CHECK_PROTOTYPE(gethostid, libc.h)
AC_CHECK_PROTOTYPE(gethostname)
AC_CHECK_PROTOTYPE(getsockopt, sys/types.h sys/socket.h)
AC_CHECK_PROTOTYPE(listen, sys/types.h sys/socket.h)
AC_CHECK_PROTOTYPE(socket, sys/types.h sys/socket.h)
AC_CHECK_PROTOTYPE(connect, sys/types.h sys/socket.h)
AC_CHECK_PROTOTYPE(setsockopt, sys/types.h sys/socket.h)
AC_CHECK_PROTOTYPE(wait3, sys/wait.h sys/time.h sys/resource.h)

if test $ac_cv_header_libc_h = yes ; then
AC_CHECK_PROTOTYPE(mktemp, stdlib.h libc.h)
else
AC_CHECK_PROTOTYPE(mktemp, stdlib.h)
fi

if test "$no_x" = "yes" ; then
X_STD_LIBS=
else
X_STD_LIBS=-lX11
fi

dnl Special Definitions for output
AC_SUBST(configdir)
AC_SUBST(X_STD_LIBS)
common_makefile=Makefile.def
AC_SUBST(common_makefile)

files=`find . -name "*.in" -print | grep -v "/config" | sed -e 's/.in$/ /g'`
files="$configdir/Makefile.def $configdir/Makefile $files"

dnl It is very difficult to put configdir into config.status.
dnl To export the variable was the only way for this.
export configdir
AC_OUTPUT($files)


