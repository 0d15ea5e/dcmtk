#
#	Makefile for dcmdata
#


@SET_MAKE@

SHELL = /bin/sh
VPATH=@srcdir@:@top_srcdir@/include:@top_srcdir@/@configdir@/include
srcdir=@srcdir@
top_srcdir=@top_srcdir@
configdir=@top_srcdir@/@configdir@

# Special defines for the Library, define them in LOCALDEFS
#   DICOMDIR_WITHOUT_BACKUP
#	no Backup for DICOMDIR files. default: not defined

LOCALDEFS= 

DICTFILE=dicom.dic

include $(configdir)/@common_makefile@

support_progs= mkdeftag mkdictbi

support_objs= mkdeftag.o mkdictbi.o

dictobjs=	dctagkey.o dcdicent.o dcdict.o dcdictbi.o \
		dcentset.o dcentbst.o dcentlst.o dcvr.o

objs= 	dcpixseq.o dcpxitem.o dcuid.o dcerror.o dcbuf.o \
	dcstack.o dclist.o dcswap.o dcstream.o dctag.o dcxfer.o \
	dcdebug.o dcobject.o dcelem.o dcitem.o dcmetinf.o dcdatset.o \
	dcsequen.o dcfilefo.o dcbytstr.o dcvrae.o dcvras.o dcvrcs.o \
	dcvrda.o dcvrds.o dcvrdt.o dcvris.o dcvrtm.o dcvrui.o \
	dcchrstr.o dcvrlo.o dcvrlt.o dcvrpn.o dcvrsh.o dcvrst.o dcvrobow.o \
	dcvrat.o dcvrss.o dcvrus.o dcvrsl.o dcvrul.o dcvrulup.o dcvrfl.o \
	dcvrfd.o dcdirrec.o dcdirrcf.o dcdicdir.o dcvm.o \
	$(dictobjs) cmdlnarg.o


all: libdcmdata.a


install: install-bin install-lib install-include install-support

install-bin:	$(libdir)/dicom.dic

install-lib:	$(libdir)/libdcmdata.a

install-include:

install-support: install-bin

$(libdir)/dicom.dic:	dicom.dic
	$(configdir)/mkinstalldirs $(libdir)
	$(INSTALL_DATA) dicom.dic $(libdir)/dicom.dic

$(libdir)/libdcmdata.a:	libdcmdata.a
	$(configdir)/mkinstalldirs $(libdir)
	$(INSTALL_DATA) libdcmdata.a $(libdir)/libdcmdata.a

clean:
	rm -f $(support_progs) $(support_objs) 
	rm -f $(objs) 
	rm -f libdcmdata.a 
	rm -f $(TRASH)

distclean: nobuiltindict clean
	rm -f $(DISTTRASH) 


libdcmdata.a: $(objs)
	$(AR) $(ARFLAGS) $@ $(objs)
	$(RANLIB) $@


mkdeftag:	mkdeftag.o $(dictobjs) cmdlnarg.o
	$(CXX) $(CXXFLAGS) $(LDFLAGS) $(LIBDIRS) -o $@ $@.o $(dictobjs) cmdlnarg.o $(LOCALLIBS) $(LIBS)

mkdictbi:	mkdictbi.o $(dictobjs) cmdlnarg.o
	$(CXX) $(CXXFLAGS) $(LDFLAGS) $(LIBDIRS) -o $@ $@.o $(dictobjs) cmdlnarg.o $(LOCALLIBS) $(LIBS)


# Generate a new include file of defined tags

gendeftag:	mkdeftag $(DICTFILE)
	`pwd`/mkdeftag `pwd`/$(DICTFILE) > $(top_srcdir)/include/dcdeftag.h

# Generate a file which can be used as a builtin dictionary

dcdictzz.cc:	mkdictbi $(DICTFILE)
	`pwd`/mkdictbi `pwd`/$(DICTFILE) > dcdictzz.cc

# Generate a builtin data dictionary from $(DICTFILE)

builtindict:	nobuiltindict mkdictbi $(DICTFILE)
	`pwd`/mkdictbi `pwd`/$(DICTFILE) > dcdictbi.cc

# Generate an empty builtin data dictionary
 
nobuiltindict:
	cp dcdictbi.nul dcdictbi.cc

# Dependencies

dependencies:
	$(CXX) -MM $(defines) $(includes) $(CPPFLAGS) $(CXXFLAGS) *.cc  > $(DEP)

$(objs): config.h


include $(DEP)

